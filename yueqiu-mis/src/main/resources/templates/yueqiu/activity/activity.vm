<!DOCTYPE html>
<html>
<head>
#parse("head.vm")
<link rel="stylesheet" href="/css/dashboard.css">
<title>活动详情 - $activity.name</title>
</head>
<body>
    #parse("/navbar.vm")

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">#parse("/$project/menu.vm")</div>
            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <h2 class="page-header">活动详情</h2>
                <div class="row">
                    <div class="form-horizontal">
                        <input type="hidden" id="id" name="id" value="$id">
                        <div class="form-group">
                            <label for="title" class="col-sm-2 control-label">标题</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="title" placeholder="标题" value="$!activity.title" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-sm-2 control-label">球场</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="stadiumId" placeholder="球场" value="" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-sm-2 control-label">日期</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" id="date" placeholder="日期" value="" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-sm-2 control-label">价格</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" id="price" placeholder="价格" value="$!activity.price" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-sm-2 control-label">组织者</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="address" placeholder="地址" value="" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="price" class="col-sm-2 control-label">人数</label>
                            <div class="col-sm-1">
                                <input type="text" class="form-control" id="total" placeholder="人数" value="$!activity.total" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="value" class="col-sm-2 control-label">已报名</label>
                            <div class="col-sm-1">
                                <input type="text" class="form-control" id="attend" placeholder="已报名" value="$!activity.attend" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="gallery" class="col-sm-2 control-label">状态</label>
                            <div class="col-sm-2">
                                <select class="form-control">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="button" id="save" class="btn btn-primary">保存</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    #parse("/footer.vm")
    #parse("/upload.vm")
    <script type="text/javascript">
    jQuery(function () {
        'use strict';
        
        upload('gallery', function(e, data) {
            var ret = data.result;
            if (ret.code == 200) {
                var jimg = jQuery(imgTemplate);
                var src = ret.urls[0];
                jimg.data('imgUrl', src);
                jimg.find('img').attr('src', src);
                jimg.find('input[name="gallery[]"]').val(src);
                jQuery('#btn_gallery').parent().before(jimg);
            }
        });
        
        jQuery('#save').click(function() {
            ajaxPost('/yueqiu/stadiums/$id', ['id', 'name', 'address', 'latitude', 'longitude', 'size', 'gallery[]', 'phone'], 
            function(data, status, jqXHR) {
                alert('修改成功');
            }, function(jqXHR, status, e) {
                alert('修改失败');
            });
        });
        
    });
    var imgTemplate = '<div class="col-sm-2"><button class="close delete">&times;</button><img src="" class="img-responsive"><input type="hidden" name="gallery[]" value=""></div>';
    var jprogress = jQuery('#progress');
    var jprogressbar = jprogress.find('.progress-bar');
    
    function upload(id, callback) {
        jQuery('#btn_' + id).click(function() {
            jQuery('#input_' + id).click();
        });
        jQuery('#input_' + id).fileupload({
            url: '/upload',
            formData: {
                'bucket': 'stadium'
            },
            dataType: 'json',
            done: function(e, data) {
                jprogress.addClass('hide');
                callback(e, data);
            },
            send: function(e,data) {
                jprogress.removeClass('hide').css({
                    'top': ($(window).height() - 30) / 2,
                    'left': ($(window).width() - 200) / 2
                });
                jprogressbar.css('width', 0);
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                jprogressbar.css('width', progress + '%');
            }
        });
    }
    
    function showMap() {
        var q = jQuery('#name').val();
        window.open('/yueqiu/location?q=' + q + '&cid=010', "", 'width=800,height=500,top=100,left=200');
    }
    function selectPos(address, lng, lat) {
        jQuery('#address').val(address);
        jQuery('#latitude').val(lat);
        jQuery('#longitude').val(lng);
        jQuery('#latlng').html('&nbsp;' + lng + ', ' + lat + '&nbsp;&nbsp;');
    }
    </script>
</body>
</html>